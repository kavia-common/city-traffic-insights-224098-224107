{"is_source_file": true, "format": "JavaScript", "description": "This file defines a service module 'realTrafficService.js' that interacts with the TomTom Traffic Flow API to fetch real-time traffic data for predefined city coordinates. It processes API responses to generate normalized traffic snapshots, infers congestion levels, and attempts to persist this data into a MongoDB collection using a model called TrafficRecord. The module also exposes functions and constants related to traffic data fetching and processing.", "external_files": ["../logger", "../models/TrafficRecord"], "external_methods": ["TrafficRecord.insertMany"], "published": ["fetchRealTimeCity", "CITY_COORDS"], "classes": [], "methods": [{"name": "inferCongestionLevel(relativeSpeed, currentSpeed)", "description": "Determines congestion level based on relative speed and current speed, outputting a normalized value between 0 and 1.", "scope": "", "scopeKind": ""}, {"name": "buildSegmentId(city, frc, speed)", "description": "Creates a synthetic segment ID string based on city name, functional road class (frc), and speed.", "scope": "", "scopeKind": ""}, {"name": "fetchRealTimeCity(city)", "description": "Fetches and normalizes live traffic data for a specific city from the TomTom Traffic API, including error handling and basic data transformation, with an attempt to persist data asynchronously.", "scope": "", "scopeKind": ""}], "calls": ["fetch", "TrafficRecord.insertMany", "logger.warn", "logger.error", "logger.info"], "search-terms": ["realTrafficService", "TomTom API", "fetchRealTimeCity", "traffic snapshot", "CITY_COORDS"], "state": 2, "file_id": 22, "knowledge_revision": 73, "git_revision": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e", "revision_history": [{"65": ""}, {"73": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e"}], "ctags": [{"_type": "tag", "name": "Bangalore", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Bangalore: { lat: 12.9716, lng: 77.5946 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_COORDS", "scopeKind": "class"}, {"_type": "tag", "name": "CITY_COORDS", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^const CITY_COORDS = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "Delhi", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Delhi: { lat: 28.6139, lng: 77.2090 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_COORDS", "scopeKind": "class"}, {"_type": "tag", "name": "Mumbai", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Mumbai: { lat: 19.0760, lng: 72.8777 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_COORDS", "scopeKind": "class"}, {"_type": "tag", "name": "TOMTOM_BASE", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^const TOMTOM_BASE = 'https:\\/\\/api.tomtom.com\\/traffic\\/services\\/4\\/flowSegmentData\\/relative0\\//", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "TrafficRecord", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^const TrafficRecord = require('..\\/models\\/TrafficRecord');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "buildSegmentId", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^function buildSegmentId(city, frc, speed) {$/", "language": "JavaScript", "kind": "function", "signature": "(city, frc, speed)"}, {"_type": "tag", "name": "city", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^    city,$/", "language": "JavaScript", "kind": "field", "scope": "fetchRealTimeCity.snapshot", "scopeKind": "class"}, {"_type": "tag", "name": "coordinates", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^    coordinates: line,$/", "language": "JavaScript", "kind": "property", "scope": "fetchRealTimeCity.feature", "scopeKind": "class"}, {"_type": "tag", "name": "densityVpkm", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^    densityVpkm,$/", "language": "JavaScript", "kind": "field", "scope": "fetchRealTimeCity.feature", "scopeKind": "class"}, {"_type": "tag", "name": "feature", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  const feature = {$/", "language": "JavaScript", "kind": "class", "scope": "fetchRealTimeCity", "scopeKind": "class"}, {"_type": "tag", "name": "fetchRealTimeCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  fetchRealTimeCity,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "fetchRealTimeCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^async function fetchRealTimeCity(city) {$/", "language": "JavaScript", "kind": "function", "signature": "(city)"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^    id: buildSegmentId(city, seg.frc, currentSpeed),$/", "language": "JavaScript", "kind": "property", "scope": "fetchRealTimeCity.feature", "scopeKind": "class"}, {"_type": "tag", "name": "inferCongestionLevel", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^function inferCongestionLevel(relativeSpeed, currentSpeed) {$/", "language": "JavaScript", "kind": "function", "signature": "(relativeSpeed, currentSpeed)"}, {"_type": "tag", "name": "lat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Bangalore: { lat: 12.9716, lng: 77.5946 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_COORDS.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "lat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Delhi: { lat: 28.6139, lng: 77.2090 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_COORDS.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "lat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Mumbai: { lat: 19.0760, lng: 72.8777 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_COORDS.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "lng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Bangalore: { lat: 12.9716, lng: 77.5946 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_COORDS.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "lng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Delhi: { lat: 28.6139, lng: 77.2090 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_COORDS.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "lng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^  Mumbai: { lat: 19.0760, lng: 72.8777 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_COORDS.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^const logger = require('..\\/logger');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "speedKph", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/realTrafficService.js", "pattern": "/^    speedKph: Number.isFinite(currentSpeed) ? Number(currentSpeed.toFixed(2)) : null,$/", "language": "JavaScript", "kind": "property", "scope": "fetchRealTimeCity.feature", "scopeKind": "class"}], "hash": "46a97e98d2f123336aef1e0c394e03b6", "format-version": 4, "code-base-name": "traffic_backend", "filename": "traffic_backend/src/services/realTrafficService.js", "fields": [{"name": "city,", "scope": "fetchRealTimeCity.snapshot", "scopeKind": "class", "description": "unavailable"}, {"name": "coordinates: line,", "scope": "fetchRealTimeCity.feature", "scopeKind": "class", "description": "unavailable"}, {"name": "densityVpkm,", "scope": "fetchRealTimeCity.feature", "scopeKind": "class", "description": "unavailable"}, {"name": "fetchRealTimeCity,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "id: buildSegmentId(city, seg.frc, currentSpeed),", "scope": "fetchRealTimeCity.feature", "scopeKind": "class", "description": "unavailable"}, {"name": "Bangalore: { lat: 12.9716, lng: 77.5946 },", "scope": "CITY_COORDS.Bangalore", "scopeKind": "class", "description": "unavailable"}, {"name": "Delhi: { lat: 28.6139, lng: 77.2090 },", "scope": "CITY_COORDS.Delhi", "scopeKind": "class", "description": "unavailable"}, {"name": "Mumbai: { lat: 19.0760, lng: 72.8777 },", "scope": "CITY_COORDS.Mumbai", "scopeKind": "class", "description": "unavailable"}, {"name": "speedKph: Number.isFinite(currentSpeed) ? Number(currentSpeed.toFixed(2)) : null,", "scope": "fetchRealTimeCity.feature", "scopeKind": "class", "description": "unavailable"}]}