{"is_source_file": true, "format": "JavaScript", "description": "This file defines a TrafficController class responsible for handling traffic-related API endpoints such as live traffic, traffic history, and traffic prediction. It interacts with services and logger modules to retrieve data, process requests, and respond with JSON. The class methods include live(), history(), and predict() with detailed request validation and fallback mechanisms.", "external_files": ["../services/traffic", "../logger"], "external_methods": ["store.getLiveSnapshot", "getDbHistory", "normalizeCity", "logger.debug", "logger.error", "logger.warn"], "published": ["TrafficController"], "classes": [{"name": "TrafficController", "description": "Controller class managing traffic-related API endpoints including live, historical, and predictive traffic data."}], "methods": [{"name": "live(req, res)", "description": "Fetches a live traffic snapshot for a given city, returning data suitable for map overlays. Handles errors and ensures data consistency.", "scope": "TrafficController", "scopeKind": "class"}, {"name": "history(req, res)", "description": "Returns recent traffic history filtered by timestamps and city. Attempts to retrieve data from database with fallback to in-memory data if needed. Supports optional format parameter.", "scope": "TrafficController", "scopeKind": "class"}, {"name": "predict(req, res)", "description": "Provides short-term traffic predictions based on a specified horizon in minutes (default 15, max 120). Validates input and retrieves prediction data.", "scope": "TrafficController", "scopeKind": "class"}], "calls": ["normalizeCity(req.query.city)", "store.getLiveSnapshot(city)", "getDbHistory({ fromISO: from, toISO: to, limit: 50, city })", "store.getHistory(from, to, city)", "store.predictShortTerm(horizon, city)"], "search-terms": ["traffic endpoints", "live traffic snapshot", "traffic history fallback", "short-term traffic prediction", "MongoDB traffic history", "traffic controller class"], "state": 2, "file_id": 16, "knowledge_revision": 75, "git_revision": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e", "revision_history": [{"33": ""}, {"56": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"60": "473fed1cd8852177e4e36de9af1af8d43c50bed7"}, {"67": "772af656656064da734b02a54db4e0b8e97124a2"}, {"75": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e"}], "ctags": [{"_type": "tag", "name": "TrafficController", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^class TrafficController {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^module.exports = new TrafficController();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "history", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^  async history(req, res) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res)", "scope": "TrafficController", "scopeKind": "class"}, {"_type": "tag", "name": "live", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^  async live(req, res) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res)", "scope": "TrafficController", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^const logger = require('..\\/logger');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "predict", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^  predict(req, res) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res)", "scope": "TrafficController", "scopeKind": "class"}], "hash": "c62780f87321834946ef491671bb32a2", "format-version": 4, "code-base-name": "traffic_backend", "filename": "traffic_backend/src/controllers/traffic.js", "fields": [{"name": "module.exports = new TrafficController();", "scope": "module", "scopeKind": "class", "description": "unavailable"}]}