{"is_source_file": true, "format": "JavaScript", "description": "This file defines the TrafficController class for handling traffic-related API endpoints: live traffic data, historical data, and predictions. It manages incoming HTTP requests, interacts with traffic data services, and returns JSON responses.", "external_files": ["../services/traffic", "../logger"], "external_methods": ["require('../services/traffic').store", "require('../services/traffic').getDbHistory", "require('../services/traffic').normalizeCity", "require('../services/traffic').DEFAULT_CITY", "require('../logger')", "store.getLiveSnapshot", "store.getHistory", "getDbHistory", "normalizeCity", "logger.debug", "logger.error", "logger.warn", "res.status", "res.json", "req.query", "req.query.city", "req.query.from", "req.query.to", "req.query.horizonMinutes", "res.status().json()"], "published": ["new TrafficController()"], "classes": [{"name": "TrafficController", "description": "Controller class providing endpoints for live traffic data, traffic history, and traffic predictions."}], "methods": [{"name": "live(req, res)", "description": "Handles live traffic snapshot request, returning current traffic data for a specified city.", "scope": "TrafficController", "scopeKind": "class"}, {"name": "history(req, res)", "description": "Provides recent traffic history with optional timestamp filters, fetching data from database or in-memory fallback.", "scope": "TrafficController", "scopeKind": "class"}, {"name": "predict(req, res)", "description": "Returns short-term traffic predictions for a specified horizon and city.", "scope": "TrafficController", "scopeKind": "class"}], "calls": ["normalizeCity(req.query.city)", "store.getLiveSnapshot(city)", "logger.debug", "logger.error", "getDbHistory({ fromISO: from, toISO: to, limit: 50, city })", "store.getHistory(from, to, city)", "logger.warn", "res.status(200).json(snapshot)", "res.status(500).json({ error: { message: 'Unable to get live traffic' } })", "res.status(400).json({ error: { code: 'VALIDATION_ERROR', message: 'Invalid from timestamp' } })", "res.status(400).json({ error: { code: 'VALIDATION_ERROR', message: 'Invalid to timestamp' } })", "store.predictShortTerm(horizon, city)", "res.status(200).json(data)", "res.status(500).json({ error: { message: 'Prediction error' } })"], "search-terms": ["traffic controller", "live snapshot", "traffic history", "traffic prediction", "traffic backend", "traffic API"], "state": 2, "file_id": 16, "knowledge_revision": 60, "git_revision": "473fed1cd8852177e4e36de9af1af8d43c50bed7", "revision_history": [{"33": ""}, {"56": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"60": "473fed1cd8852177e4e36de9af1af8d43c50bed7"}], "ctags": [{"_type": "tag", "name": "TrafficController", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^class TrafficController {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^module.exports = new TrafficController();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "history", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^  async history(req, res) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res)", "scope": "TrafficController", "scopeKind": "class"}, {"_type": "tag", "name": "live", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^  live(req, res) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res)", "scope": "TrafficController", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^const logger = require('..\\/logger');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "predict", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/controllers/traffic.js", "pattern": "/^  predict(req, res) {$/", "language": "JavaScript", "kind": "method", "signature": "(req, res)", "scope": "TrafficController", "scopeKind": "class"}], "hash": "3d705aa5bd60ad3faf9a103d5830f449", "format-version": 4, "code-base-name": "traffic_backend", "filename": "traffic_backend/src/controllers/traffic.js", "fields": [{"name": "module.exports = new TrafficController();", "scope": "module", "scopeKind": "class", "description": "unavailable"}]}