{"is_source_file": true, "format": "JavaScript", "description": "This file defines a Traffic service module for managing city traffic data, including simulation and real-time data fetching, historical data retrieval, and predictions. It includes city normalization, bounding box definitions, simulated road segment generation, scheduled snapshot updates, and prediction methods, with integration to a MongoDB model TrafficRecord.", "external_files": ["../logger", "../models/TrafficRecord", "./realTrafficService"], "external_methods": ["require('../logger')", "require('../models/TrafficRecord')", "require('./realTrafficService').fetchRealTimeCity"], "published": ["store", "getDbHistory", "normalizeCity", "DEFAULT_CITY", "validateCity"], "classes": [{"name": "TrafficStore", "description": "In-memory store managing simulated city traffic segments and snapshots, including periodic background updates and data persistence."}], "methods": [{"name": "normalizeCity(input)", "description": "Normalize raw city input into one of the supported city enums ('Bangalore', 'Mumbai', 'Delhi').", "scope": "", "scopeKind": ""}, {"name": "validateCity(raw)", "description": "Validate raw city input against allowed enum values, returning validation result.", "scope": "", "scopeKind": ""}, {"name": "getLiveSnapshot(cityInput)", "description": "Retrieve the latest traffic snapshot for a city, fetching real-time data in production mode or serving simulated data in testing.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "getHistory(fromISO, toISO, cityInput)", "description": "Get aggregated historical traffic data from in-memory store for a specified time range and city.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "getDbHistory({ fromISO, toISO, limit = 50, city = DEFAULT_CITY } = {})", "description": "Fetch recent persisted traffic records from MongoDB for a city, aggregating into a summary.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "predictShortTerm(horizonMinutes = 15, cityInput)", "description": "Generate short-term traffic predictions based on current patterns and randomness.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "predictTrendBased(horizonMinutes = 15, cityInput)", "description": "Generate trend-based traffic forecasts using recent historical data, with optional time series projection.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "AnonymousFunction3838e37e0100()", "scope": "mulberry32", "scopeKind": "function", "description": "unavailable"}, {"name": "_buildSimulatedSnapshot(cityInput)", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "_collectRecentFromDb(city, n = 10)", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "_collectRecentFromMemory(ctx, n = 10)", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "_ensureCity(city)", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "_startScheduler()", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "buildRegressionSeries(samples, nowMs, stepMin, steps)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "clamp01(v)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "constructor()", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "gaussianPeak(x, center, width)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "generateSegmentsForCity(city, seed = 24)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "lerp(a, b, t)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "mulberry32(a)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "round2(v)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "round3(v)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetchRealTimeCity", "TrafficRecord.insertMany", "TrafficRecord.find"], "search-terms": ["traffic_backend", "city traffic simulation", "in-memory traffic store", "simulate city segments", "scheduled snapshots", "predict short-term traffic", "trend-based prediction"], "state": 2, "file_id": 15, "knowledge_revision": 102, "git_revision": "def4b561ffdc823e90a7e3d3eede931d12c7571b", "revision_history": [{"31": ""}, {"53": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"54": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"55": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"59": "473fed1cd8852177e4e36de9af1af8d43c50bed7"}, {"66": "772af656656064da734b02a54db4e0b8e97124a2"}, {"74": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e"}, {"76": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e"}, {"81": "dc2dffba5828c7f9a27b75ef30529b82b4c4fda1"}, {"82": "dc2dffba5828c7f9a27b75ef30529b82b4c4fda1"}, {"90": "efefb38826d07e3e548687711bca43677126d73b"}, {"91": "04f498a6d2cf25239f5079c97f3cdd92088bb23e"}, {"92": "04f498a6d2cf25239f5079c97f3cdd92088bb23e"}, {"93": "04f498a6d2cf25239f5079c97f3cdd92088bb23e"}, {"99": "1d46c49ef9f3a71e66efe8c6a934124c28fd00e7"}, {"100": "11441553a830e2eed2f539d1b4a16347e123111b"}, {"102": "def4b561ffdc823e90a7e3d3eede931d12c7571b"}], "ctags": [{"_type": "tag", "name": "AnonymousFunction3838e37e0100", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  return function () {$/", "language": "JavaScript", "kind": "function", "signature": "()", "scope": "mulberry32", "scopeKind": "function"}, {"_type": "tag", "name": "Bangalore", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_BBOX", "scopeKind": "class"}, {"_type": "tag", "name": "CITY_BBOX", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const CITY_BBOX = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "DEFAULT_CITY", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const DEFAULT_CITY = 'Bangalore';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Delhi", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_BBOX", "scopeKind": "class"}, {"_type": "tag", "name": "Mumbai", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_BBOX", "scopeKind": "class"}, {"_type": "tag", "name": "TrafficRecord", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const TrafficRecord = require('..\\/models\\/TrafficRecord');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "TrafficStore", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^class TrafficStore {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "_buildSimulatedSnapshot", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _buildSimulatedSnapshot(cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "_collectRecentFromDb", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  async _collectRecentFromDb(city, n = 10) {$/", "language": "JavaScript", "kind": "method", "signature": "(city, n = 10)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "_collectRecentFromMemory", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _collectRecentFromMemory(ctx, n = 10) {$/", "language": "JavaScript", "kind": "method", "signature": "(ctx, n = 10)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "_ensureCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _ensureCity(city) {$/", "language": "JavaScript", "kind": "method", "signature": "(city)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "_startScheduler", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _startScheduler() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "buildRegressionSeries", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function buildRegressionSeries(samples, nowMs, stepMin, steps) {$/", "language": "JavaScript", "kind": "function", "signature": "(samples, nowMs, stepMin, steps)"}, {"_type": "tag", "name": "city", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^    const query = { city: normalized };$/", "language": "JavaScript", "kind": "property", "scope": "TrafficStore.getDbHistory.query", "scopeKind": "class"}, {"_type": "tag", "name": "clamp01", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function clamp01(v) { return Math.max(0, Math.min(1, v)); }$/", "language": "JavaScript", "kind": "function", "signature": "(v)"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  constructor() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "gaussianPeak", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function gaussianPeak(x, center, width) {$/", "language": "JavaScript", "kind": "function", "signature": "(x, center, width)"}, {"_type": "tag", "name": "generateSegmentsForCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function generateSegmentsForCity(city, seed = 24) {$/", "language": "JavaScript", "kind": "function", "signature": "(city, seed = 24)"}, {"_type": "tag", "name": "getDbHistory", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  async getDbHistory({ fromISO, toISO, limit = 50, city = DEFAULT_CITY } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ fromISO, toISO, limit = 50, city = DEFAULT_CITY } = {})", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "getHistory", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  getHistory(fromISO, toISO, cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(fromISO, toISO, cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "getLiveSnapshot", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  async getLiveSnapshot(cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "lerp", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function lerp(a, b, t) { return a + (b - a) * t; }$/", "language": "JavaScript", "kind": "function", "signature": "(a, b, t)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const logger = require('..\\/logger');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "maxLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "maxLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "maxLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "maxLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "maxLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "maxLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "minLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "minLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "minLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "minLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "minLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "minLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "mulberry32", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function mulberry32(a) {$/", "language": "JavaScript", "kind": "function", "signature": "(a)"}, {"_type": "tag", "name": "normalizeCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function normalizeCity(input) {$/", "language": "JavaScript", "kind": "function", "signature": "(input)"}, {"_type": "tag", "name": "predictShortTerm", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  predictShortTerm(horizonMinutes = 15, cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(horizonMinutes = 15, cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "predictTrendBased", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  async predictTrendBased(horizonMinutes = 15, cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(horizonMinutes = 15, cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^    const query = { city: normalized };$/", "language": "JavaScript", "kind": "class", "scope": "TrafficStore.getDbHistory", "scopeKind": "class"}, {"_type": "tag", "name": "round2", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function round2(v) { return Math.round(v * 100) \\/ 100; }$/", "language": "JavaScript", "kind": "function", "signature": "(v)"}, {"_type": "tag", "name": "round3", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function round3(v) { return Math.round(v * 1000) \\/ 1000; }$/", "language": "JavaScript", "kind": "function", "signature": "(v)"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  store,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const store = new TrafficStore();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "validateCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function validateCity(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}], "hash": "d3c600e233c356ff427a53a7c0f8fce8", "format-version": 4, "code-base-name": "traffic_backend", "filename": "traffic_backend/src/services/traffic.js", "fields": [{"name": "const query = { city: normalized };", "scope": "TrafficStore.getDbHistory.query", "scopeKind": "class", "description": "unavailable"}, {"name": "Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class", "description": "unavailable"}, {"name": "Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },", "scope": "CITY_BBOX.Delhi", "scopeKind": "class", "description": "unavailable"}, {"name": "Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class", "description": "unavailable"}, {"name": "store,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}]}