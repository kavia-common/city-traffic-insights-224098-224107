{"is_source_file": true, "format": "JavaScript", "description": "This file defines a traffic service module that manages traffic data for multiple cities. It includes functions for normalizing and validating city inputs, generating simulated traffic segments, maintaining in-memory snapshots and history, and retrieving or simulating current traffic snapshots and historical data. It interacts with external modules for logging, database persistence (via the TrafficRecord model), and external traffic data fetching. The code supports both simulation mode and real data mode based on environment variables, and periodically updates simulated traffic snapshots in the background.", "external_files": ["../logger", "../models/TrafficRecord", "./realTrafficService"], "external_methods": ["require('../logger')", "require('../models/TrafficRecord')", "require('./realTrafficService').fetchRealTimeCity"], "published": ["store", "getDbHistory", "normalizeCity", "DEFAULT_CITY", "validateCity"], "classes": [{"name": "TrafficStore", "description": "In-memory data store managing simulated traffic segments, snapshots, and history for each city. It handles periodic snapshot updates, random traffic data generation, fetching real-time data when in live mode, and historical data retrieval."}], "methods": [{"name": "normalizeCity(input)", "description": "Converts various city input strings into standardized city names ('Bangalore', 'Mumbai', 'Delhi').", "scope": "", "scopeKind": ""}, {"name": "validateCity(raw)", "description": "Validates raw city input against allowed city names; returns validation status, normalized value, and errors if any.", "scope": "", "scopeKind": ""}, {"name": "getLiveSnapshot(cityInput)", "description": "Fetches either real-time traffic data from an external API or returns the latest simulated snapshot for a city.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "getHistory(fromISO, toISO, cityInput)", "description": "Returns aggregated in-memory historical traffic data for a specific time range and city.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "getDbHistory({ fromISO, toISO, limit = 50, city = DEFAULT_CITY } = {})", "description": "Fetches recent persisted traffic data from MongoDB and returns aggregated statistics.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "predictShortTerm(horizonMinutes = 15, cityInput)", "description": "Provides a short-term traffic prediction based on recent data and time-of-day patterns.", "scope": "TrafficStore", "scopeKind": "class"}, {"name": "AnonymousFunction3838e37e0100()", "scope": "mulberry32", "scopeKind": "function", "description": "unavailable"}, {"name": "_buildSimulatedSnapshot(cityInput)", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "_ensureCity(city)", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "_startScheduler()", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "constructor()", "scope": "TrafficStore", "scopeKind": "class", "description": "unavailable"}, {"name": "gaussianPeak(x, center, width)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "generateSegmentsForCity(city, seed = 24)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "lerp(a, b, t)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "mulberry32(a)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["require('../logger')", "require('../models/TrafficRecord')", "require('./realTrafficService').fetchRealTimeCity"], "search-terms": ["traffic segments generation", "simulated traffic snapshot", "city bounding boxes", "traffic history aggregation", "background scheduler", "traffic data persistence", "real-time traffic fetching"], "state": 2, "file_id": 15, "knowledge_revision": 93, "git_revision": "04f498a6d2cf25239f5079c97f3cdd92088bb23e", "revision_history": [{"31": ""}, {"53": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"54": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"55": "fa132d5faf7b5336615e3b7aeea2bd03a3319a9f"}, {"59": "473fed1cd8852177e4e36de9af1af8d43c50bed7"}, {"66": "772af656656064da734b02a54db4e0b8e97124a2"}, {"74": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e"}, {"76": "5f4807e06d3b43b6d2b14cbd65a9a2afb01e017e"}, {"81": "dc2dffba5828c7f9a27b75ef30529b82b4c4fda1"}, {"82": "dc2dffba5828c7f9a27b75ef30529b82b4c4fda1"}, {"90": "efefb38826d07e3e548687711bca43677126d73b"}, {"91": "04f498a6d2cf25239f5079c97f3cdd92088bb23e"}, {"92": "04f498a6d2cf25239f5079c97f3cdd92088bb23e"}, {"93": "04f498a6d2cf25239f5079c97f3cdd92088bb23e"}], "ctags": [{"_type": "tag", "name": "AnonymousFunction3838e37e0100", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  return function () {$/", "language": "JavaScript", "kind": "function", "signature": "()", "scope": "mulberry32", "scopeKind": "function"}, {"_type": "tag", "name": "Bangalore", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_BBOX", "scopeKind": "class"}, {"_type": "tag", "name": "CITY_BBOX", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const CITY_BBOX = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "DEFAULT_CITY", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const DEFAULT_CITY = 'Bangalore';$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "Delhi", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_BBOX", "scopeKind": "class"}, {"_type": "tag", "name": "Mumbai", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "class", "scope": "CITY_BBOX", "scopeKind": "class"}, {"_type": "tag", "name": "TrafficRecord", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const TrafficRecord = require('..\\/models\\/TrafficRecord');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "TrafficStore", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^class TrafficStore {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "_buildSimulatedSnapshot", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _buildSimulatedSnapshot(cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "_ensureCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _ensureCity(city) {$/", "language": "JavaScript", "kind": "method", "signature": "(city)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "_startScheduler", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  _startScheduler() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "city", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^    const query = { city: normalized };$/", "language": "JavaScript", "kind": "property", "scope": "TrafficStore.getDbHistory.query", "scopeKind": "class"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  constructor() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "gaussianPeak", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function gaussianPeak(x, center, width) {$/", "language": "JavaScript", "kind": "function", "signature": "(x, center, width)"}, {"_type": "tag", "name": "generateSegmentsForCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function generateSegmentsForCity(city, seed = 24) {$/", "language": "JavaScript", "kind": "function", "signature": "(city, seed = 24)"}, {"_type": "tag", "name": "getDbHistory", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  async getDbHistory({ fromISO, toISO, limit = 50, city = DEFAULT_CITY } = {}) {$/", "language": "JavaScript", "kind": "method", "signature": "({ fromISO, toISO, limit = 50, city = DEFAULT_CITY } = {})", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "getHistory", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  getHistory(fromISO, toISO, cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(fromISO, toISO, cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "getLiveSnapshot", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  async getLiveSnapshot(cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "lerp", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function lerp(a, b, t) { return a + (b - a) * t; }$/", "language": "JavaScript", "kind": "function", "signature": "(a, b, t)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const logger = require('..\\/logger');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "maxLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "maxLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "maxLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "maxLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "maxLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "maxLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "minLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "minLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "minLat", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "minLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class"}, {"_type": "tag", "name": "minLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Delhi", "scopeKind": "class"}, {"_type": "tag", "name": "minLng", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },$/", "language": "JavaScript", "kind": "property", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class"}, {"_type": "tag", "name": "mulberry32", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function mulberry32(a) {$/", "language": "JavaScript", "kind": "function", "signature": "(a)"}, {"_type": "tag", "name": "normalizeCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function normalizeCity(input) {$/", "language": "JavaScript", "kind": "function", "signature": "(input)"}, {"_type": "tag", "name": "predictShortTerm", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  predictShortTerm(horizonMinutes = 15, cityInput) {$/", "language": "JavaScript", "kind": "method", "signature": "(horizonMinutes = 15, cityInput)", "scope": "TrafficStore", "scopeKind": "class"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^    const query = { city: normalized };$/", "language": "JavaScript", "kind": "class", "scope": "TrafficStore.getDbHistory", "scopeKind": "class"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^  store,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^const store = new TrafficStore();$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "validateCity", "path": "/home/kavia/workspace/code-generation/city-traffic-insights-224098-224107/traffic_backend/src/services/traffic.js", "pattern": "/^function validateCity(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}], "hash": "f776a32e12d5f4d1a0212bc4f2ab21e1", "format-version": 4, "code-base-name": "traffic_backend", "filename": "traffic_backend/src/services/traffic.js", "fields": [{"name": "const query = { city: normalized };", "scope": "TrafficStore.getDbHistory.query", "scopeKind": "class", "description": "unavailable"}, {"name": "Bangalore: { minLat: 12.85, maxLat: 13.12, minLng: 77.45, maxLng: 77.75 },", "scope": "CITY_BBOX.Bangalore", "scopeKind": "class", "description": "unavailable"}, {"name": "Delhi: { minLat: 28.40, maxLat: 28.88, minLng: 76.90, maxLng: 77.40 },", "scope": "CITY_BBOX.Delhi", "scopeKind": "class", "description": "unavailable"}, {"name": "Mumbai: { minLat: 18.88, maxLat: 19.30, minLng: 72.75, maxLng: 72.99 },", "scope": "CITY_BBOX.Mumbai", "scopeKind": "class", "description": "unavailable"}, {"name": "store,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}]}